{"ast":null,"code":"import _toConsumableArray from\"/Users/aranichaudhuri/GitHub/the-mall2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _defineProperty from\"/Users/aranichaudhuri/GitHub/the-mall2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/aranichaudhuri/GitHub/the-mall2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/aranichaudhuri/GitHub/the-mall2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{memo,useState,useEffect}from\"react\";import firebase from\"firebase\";import{useCollection,useDocument}from\"react-firebase-hooks/firestore\";import{connect}from\"react-redux\";import{Link}from'react-router-dom';import TopRibbon from\"../includes/TopRibbon\";import TopNavbar from\"../includes/Navbar\";import SubscribeSection from\"../includes/SubscribeSection\";import Footer from\"../includes/Footer\";import Feedback from\"../includes/Feedback\";import{Form,FormControl,Button,Modal}from\"react-bootstrap\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var StoreUpdate=function StoreUpdate(props){var _categorySnapshot$doc;var sdata=props.sdata,openHandle=props.openHandle,closeHandle=props.closeHandle,show=props.show;//category snapShot\nvar _useCollection=useCollection(firebase.firestore().collection('storeCategory')),_useCollection2=_slicedToArray(_useCollection,3),categorySnapshot=_useCollection2[0],categoryloading=_useCollection2[1],categoryerror=_useCollection2[2];var _useState=useState(_objectSpread({},sdata)),_useState2=_slicedToArray(_useState,2),storeData=_useState2[0],setStoreData=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),imgupload=_useState4[0],setimgupload=_useState4[1];useEffect(function(){setStoreData(_objectSpread({},sdata));},[sdata]);var SaveFormDatatoState=function SaveFormDatatoState(e){switch(e.target.name){case\"store_name\":setStoreData(_objectSpread(_objectSpread({},storeData),{},{name:e.target.value}));break;case\"floor_option\":setStoreData(_objectSpread(_objectSpread({},storeData),{},_defineProperty({},e.target.name,e.target.value)));break;case\"store_img\":setStoreData(_objectSpread(_objectSpread({},storeData),{},{image_url:e.target.files[0]}));setimgupload(true);break;case\"store_num\":setStoreData(_objectSpread(_objectSpread({},storeData),{},{contact_detail:e.target.value}));break;case\"store_timing\":setStoreData(_objectSpread(_objectSpread({},storeData),{},{timing:e.target.value}));break;case\"store_desc\":setStoreData(_objectSpread(_objectSpread({},storeData),{},{description:e.target.value}));break;case\"store_category\":console.log(\"target value initial \",e);var newArr=_toConsumableArray(storeData===null||storeData===void 0?void 0:storeData.category);if(e.target.checked){setStoreData(_objectSpread(_objectSpread({},storeData),{},{category:[].concat(_toConsumableArray(newArr),[e.target.value])}));}else{var index=newArr.indexOf(e.target.value);console.log(index);newArr.splice(index,1);setStoreData(_objectSpread(_objectSpread({},storeData),{},{category:_toConsumableArray(newArr)}));}break;default:break;}};var SaveStatetoDB=function SaveStatetoDB(data,e){e.preventDefault();if(imgupload){var _data$image_url;var uploadTask=firebase.storage().ref(\"\".concat(data===null||data===void 0?void 0:data.name,\"/\")).child(data===null||data===void 0?void 0:(_data$image_url=data.image_url)===null||_data$image_url===void 0?void 0:_data$image_url.name).put(data===null||data===void 0?void 0:data.image_url);uploadTask.on('state_changed',function(snapShot){//takes a snap shot of the process as it is happening\n},function(err){//catches the errors\nconsole.log(err);},function(){var _data$image_url2;// gets the functions from storage refences the image storage in firebase by the children\n// gets the download url then sets the image from firebase as the value for the imgUrl key:\nfirebase.storage().ref(\"\".concat(data===null||data===void 0?void 0:data.name,\"/\")).child(data===null||data===void 0?void 0:(_data$image_url2=data.image_url)===null||_data$image_url2===void 0?void 0:_data$image_url2.name).getDownloadURL().then(function(fireBaseUrl){firebase.firestore().collection(\"store\").doc(storeData===null||storeData===void 0?void 0:storeData.id).update(_objectSpread(_objectSpread({},storeData),{},{image_url:fireBaseUrl}));}).then(function(bruh){return alert(\"store updated success\");}).catch(function(error){console.error(error);}).finally(function(result){return setStoreData({category:[]});});});}else{firebase.firestore().collection(\"store\").doc(storeData===null||storeData===void 0?void 0:storeData.id).update(_objectSpread({},storeData)).then(function(bruh){return alert(\"store updated success\");}).catch(function(error){console.error(error);}).finally(function(result){return setStoreData({});});}//   const uploadTask = firebase.storage().ref(`${data?.name}/`).child(data?.image_url?.name).put(data?.image_url);\n//\n//   uploadTask.on('state_changed',\n// (snapShot) => {\n//   //takes a snap shot of the process as it is happening\n// }, (err) => {\n//   //catches the errors\n//   console.log(err)\n// }, () => {\n//   // gets the functions from storage refences the image storage in firebase by the children\n//   // gets the download url then sets the image from firebase as the value for the imgUrl key:\n//   firebase.storage().ref(`${data?.name}/`).child(data?.image_url?.name).getDownloadURL()\n//    .then(fireBaseUrl => {\n//      firebase.firestore().collection(\"store\").doc(storeData?.id).update({\n//        ...storeData,\n//        image_url: fireBaseUrl,\n//      })\n//    }).then((bruh) => alert(\"store updated success\"))\n//     .catch((error) => {console.error(error);})\n//     .finally((result) => setStoreData({category:[]}))\n// })\n};return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(Modal,{show:show,onHide:closeHandle,children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:\"Store Update\"})}),/*#__PURE__*/_jsx(Modal.Body,{children:/*#__PURE__*/_jsxs(Form,{onSubmit:function onSubmit(e){return SaveStatetoDB(storeData,e);},children:[/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Store Image/Logo\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"file\",onChange:SaveFormDatatoState,name:\"store_img\"})]}),/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Store Name\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",onChange:SaveFormDatatoState,name:\"store_name\",value:storeData===null||storeData===void 0?void 0:storeData.name})]}),/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Store Timing\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",onChange:SaveFormDatatoState,name:\"store_timing\",placeholder:\"Open 11am  -  8pm\",value:storeData===null||storeData===void 0?void 0:storeData.timing})]}),/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Store Description \"}),/*#__PURE__*/_jsx(Form.Control,{as:\"textarea\",onChange:SaveFormDatatoState,name:\"store_desc\",value:storeData===null||storeData===void 0?void 0:storeData.description})]}),/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Store Contact Number\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",onChange:SaveFormDatatoState,name:\"store_num\",value:storeData===null||storeData===void 0?void 0:storeData.contact_detail})]}),/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Store Category\"}),/*#__PURE__*/_jsx(\"br\",{}),categorySnapshot===null||categorySnapshot===void 0?void 0:(_categorySnapshot$doc=categorySnapshot.docs)===null||_categorySnapshot$doc===void 0?void 0:_categorySnapshot$doc.map(function(item){var _storeData$category,_item$data;return/*#__PURE__*/_jsx(Form.Check,{inline:true,onChange:SaveFormDatatoState,checked:storeData===null||storeData===void 0?void 0:(_storeData$category=storeData.category)===null||_storeData$category===void 0?void 0:_storeData$category.includes(item===null||item===void 0?void 0:(_item$data=item.data())===null||_item$data===void 0?void 0:_item$data.value),label:item===null||item===void 0?void 0:item.data().label,name:\"store_category\",id:item===null||item===void 0?void 0:item.data().id,value:item===null||item===void 0?void 0:item.data().value});})]}),/*#__PURE__*/_jsx(\"div\",{className:\"custom-select\",children:/*#__PURE__*/_jsxs(\"select\",{class:\"form-select-sm\",\"aria-label\":\"Default select example\",onChange:SaveFormDatatoState,name:\"floor_option\",value:storeData===null||storeData===void 0?void 0:storeData.floor_option,children:[/*#__PURE__*/_jsx(\"option\",{value:\"ground_floor\",children:\"Ground Floor\"}),/*#__PURE__*/_jsx(\"option\",{value:\"first_floor\",children:\"First Floor\"}),/*#__PURE__*/_jsx(\"option\",{value:\"second_floor\",children:\"Second Floor\"}),/*#__PURE__*/_jsx(\"option\",{value:\"third_floor\",children:\"Third Floor\"})]})}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",type:\"submit\",onClick:closeHandle,children:\"Upload\"})]})})]})});};export default StoreUpdate;","map":null,"metadata":{},"sourceType":"module"}