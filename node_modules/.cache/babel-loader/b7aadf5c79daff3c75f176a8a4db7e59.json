{"ast":null,"code":"import _toConsumableArray from\"/Users/aranichaudhuri/GitHub/the-mall2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _defineProperty from\"/Users/aranichaudhuri/GitHub/the-mall2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/aranichaudhuri/GitHub/the-mall2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/aranichaudhuri/GitHub/the-mall2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{memo,useState,useEffect,lazy,Suspense}from\"react\";import firebase from\"firebase\";import{useCollection,useDocument}from\"react-firebase-hooks/firestore\";import{connect}from\"react-redux\";import{Link}from'react-router-dom';import TopRibbon from\"../includes/TopRibbon\";import TopNavbar from\"../includes/Navbar\";import SubscribeSection from\"../includes/SubscribeSection\";import Footer from\"../includes/Footer\";import Feedback from\"../includes/Feedback\";import{Form,FormControl,Button,Modal,Container,Row,Col}from\"react-bootstrap\";import{Formik}from\"formik\";import*as Yup from'yup';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var StoreUpdate=/*#__PURE__*/lazy(function(){return import(\"./StoreUpdate\");});var AddCat=/*#__PURE__*/lazy(function(){return import(\"./Addcategory\");});var StoreManage=function StoreManage(){var _storeSnapshot$docs;//load category\nvar _useCollection=useCollection(firebase.firestore().collection('storeCategory')),_useCollection2=_slicedToArray(_useCollection,3),categorySnapshot=_useCollection2[0],categoryloading=_useCollection2[1],categoryerror=_useCollection2[2];//load stores\nvar _useCollection3=useCollection(firebase.firestore().collection(\"store\")),_useCollection4=_slicedToArray(_useCollection3,3),storeSnapshot=_useCollection4[0],storeLoading=_useCollection4[1],error=_useCollection4[2];//save store data from form\nvar _useState=useState({category:[]}),_useState2=_slicedToArray(_useState,2),storeData=_useState2[0],setStoreData=_useState2[1];//functions for store update modal\nvar _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),updateStore=_useState4[0],setupdateStore=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),show=_useState6[0],setShow=_useState6[1];var openHandle=function openHandle(){setShow(true);};var closeHandle=function closeHandle(){setShow(false);};//functions for store category add Modal\nvar _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),showupdateCat=_useState8[0],setShowupdateCat=_useState8[1];var deleteItem=function deleteItem(storeId,url){var imageRef=firebase.storage().refFromURL(url);imageRef.delete().then(function(){console.log(\"Deleted\");}).catch(function(err){return console.log(err);});firebase.firestore().collection('store').doc(storeId).delete();};var SaveFormDatatoState=function SaveFormDatatoState(e){switch(e.target.name){case\"store_name\":setStoreData(_objectSpread(_objectSpread({},storeData),{},{name:e.target.value}));break;case\"floor_option\":setStoreData(_objectSpread(_objectSpread({},storeData),{},_defineProperty({},e.target.name,e.target.value)));break;case\"store_img\":setStoreData(_objectSpread(_objectSpread({},storeData),{},{image_url:e.target.files[0]}));break;case\"store_num\":setStoreData(_objectSpread(_objectSpread({},storeData),{},{contact_detail:e.target.value}));break;case\"store_timing\":setStoreData(_objectSpread(_objectSpread({},storeData),{},{timing:e.target.value}));break;case\"store_desc\":setStoreData(_objectSpread(_objectSpread({},storeData),{},{description:e.target.value}));break;case\"store_category\":var newArr=_toConsumableArray(storeData===null||storeData===void 0?void 0:storeData.category);if(e.target.checked){setStoreData(_objectSpread(_objectSpread({},storeData),{},{category:[].concat(_toConsumableArray(newArr),[e.target.value])}));}else{var index=newArr.indexOf(e.target.value);console.log(index);newArr.splice(index,1);setStoreData(_objectSpread(_objectSpread({},storeData),{},{category:_toConsumableArray(newArr)}));}break;default:break;}};var SaveStatetoDB=function SaveStatetoDB(data,e){var _data$image_url;e.preventDefault();var uploadTask=firebase.storage().ref(\"\".concat(data===null||data===void 0?void 0:data.name,\"/\")).child(data===null||data===void 0?void 0:(_data$image_url=data.image_url)===null||_data$image_url===void 0?void 0:_data$image_url.name).put(data===null||data===void 0?void 0:data.image_url);uploadTask.on('state_changed',function(snapShot){//takes a snap shot of the process as it is happening\n},function(err){//catches the errors\nconsole.log(err);},function(){var _data$image_url2;// gets the functions from storage refences the image storage in firebase by the children\n// gets the download url then sets the image from firebase as the value for the imgUrl key:\nfirebase.storage().ref(\"\".concat(data===null||data===void 0?void 0:data.name,\"/\")).child(data===null||data===void 0?void 0:(_data$image_url2=data.image_url)===null||_data$image_url2===void 0?void 0:_data$image_url2.name).getDownloadURL().then(function(fireBaseUrl){firebase.firestore().collection(\"store\").add(_objectSpread(_objectSpread({},storeData),{},{image_url:fireBaseUrl}));}).then(function(bruh){return alert(\"store added success\");}).catch(function(error){console.error(error);}).finally(function(result){return setStoreData({category:[]});});});};var validationSchema=Yup.object().shape({store_img:Yup.mixed().required(\"Image is required\"),store_name:Yup.string().required(\"Name is required\"),store_timing:Yup.string().required(\"Timing is required\"),store_desc:Yup.string(),store_num:Yup.string(),store_category:Yup.array().required(\"Please select a category\"),floor_option:Yup.string()});return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"container-fluid py-5\",style:{fontFamily:\"Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif\",backgroundSize:\"cover\",backgroundPosition:\"top center\"},children:/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(Button,{variant:\"info\",className:\"text-white fw-bold\",onClick:function onClick(){return setShowupdateCat(true);},children:\"ADD CATEGORY\"}),/*#__PURE__*/_jsx(AddCat,{setCat:setShowupdateCat,showCat:showupdateCat}),/*#__PURE__*/_jsxs(\"div\",{className:\"row \",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Store Upload Form\"}),/*#__PURE__*/_jsx(Formik,{initialValues:{store_img:\"\",store_name:\"\",store_timing:\"\",store_desc:'',store_num:\"\",store_category:'',floor_option:\"\"},validationSchema:validationSchema,onSubmit:function onSubmit(values,_ref){var resetForm=_ref.resetForm,setSubmitting=_ref.setSubmitting;setSubmitting(true);resetForm();setSubmitting(false);},children:function children(_ref2){var _categorySnapshot$doc;var values=_ref2.values,errors=_ref2.errors,touched=_ref2.touched,isValid=_ref2.isValid,dirty=_ref2.dirty,handleChange=_ref2.handleChange,handleBlur=_ref2.handleBlur,isSubmitting=_ref2.isSubmitting;return/*#__PURE__*/_jsxs(Form,{onSubmit:function onSubmit(e){return SaveStatetoDB(storeData,e);},children:[/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Store Image/Logo\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"file\",onBlur:handleBlur,onChange:function onChange(e){SaveFormDatatoState(e);handleChange(e);},name:\"store_img\",value:values.store_img,className:errors.store_img&&touched.store_img?\"is-invalid\":null}),/*#__PURE__*/_jsx(Form.Control.Feedback,{type:\"invalid\",children:errors.store_img})]}),/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Store Name\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",onBlur:handleBlur,onChange:function onChange(e){SaveFormDatatoState(e);handleChange(e);},name:\"store_name\",value:values.store_name,className:errors.store_name&&touched.store_name?\"is-invalid\":null}),/*#__PURE__*/_jsx(Form.Control.Feedback,{type:\"invalid\",children:errors.store_name})]}),/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Store Timing\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",onBlur:handleBlur,onChange:function onChange(e){SaveFormDatatoState(e);handleChange(e);},name:\"store_timing\",placeholder:\"Open 11am  -  8pm\",value:values.store_timing,className:errors.store_timing&&touched.store_timing?\"is-invalid\":null}),/*#__PURE__*/_jsx(Form.Control.Feedback,{type:\"invalid\",children:errors.store_timing})]}),/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Store Description \"}),/*#__PURE__*/_jsx(Form.Control,{as:\"textarea\",onBlur:handleBlur,onChange:function onChange(e){SaveFormDatatoState(e);handleChange(e);},name:\"store_desc\",value:values.store_desc,className:errors.store_desc&&touched.store_desc?\"is-invalid\":null}),/*#__PURE__*/_jsx(Form.Control.Feedback,{type:\"invalid\",children:errors.store_desc})]}),/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Store Contact Number\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",onBlur:handleBlur,onChange:function onChange(e){SaveFormDatatoState(e);handleChange(e);},name:\"store_num\",value:values.store_num,className:errors.store_num&&touched.store_num?\"is-invalid\":null}),/*#__PURE__*/_jsx(Form.Control.Feedback,{type:\"invalid\",children:errors.store_num})]}),/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Store Category\"}),/*#__PURE__*/_jsx(\"br\",{}),categorySnapshot===null||categorySnapshot===void 0?void 0:(_categorySnapshot$doc=categorySnapshot.docs)===null||_categorySnapshot$doc===void 0?void 0:_categorySnapshot$doc.map(function(item){return/*#__PURE__*/_jsx(Form.Check,{inline:true,onBlur:handleBlur,onChange:function onChange(e){SaveFormDatatoState(e);handleChange(e);},label:item===null||item===void 0?void 0:item.data().label,name:\"store_category\",id:item===null||item===void 0?void 0:item.data().id,value:item===null||item===void 0?void 0:item.data().value,className:errors.store_category&&touched.store_category?\"is-invalid\":null});}),/*#__PURE__*/_jsx(Form.Control.Feedback,{type:\"invalid\",children:errors.store_category})]}),/*#__PURE__*/_jsxs(\"select\",{class:\"form-select-sm my-3\",\"aria-label\":\"Default select example\",onChange:function onChange(e){SaveFormDatatoState(e);handleChange(e);},name:\"floor_option\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"ground_floor\",selected:true,children:\"Ground Floor\"}),/*#__PURE__*/_jsx(\"option\",{value:\"first_floor\",selected:true,children:\"First Floor\"}),/*#__PURE__*/_jsx(\"option\",{value:\"second_floor\",children:\"Second Floor\"}),/*#__PURE__*/_jsx(\"option\",{value:\"third_floor\",children:\"Third Floor\"})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",type:\"submit\",className:dirty&&isValid?\"\":'disabled-btn',disabled:!(dirty&&isValid),children:\"Upload\"})]});}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"row my-4\",children:[storeLoading&&/*#__PURE__*/_jsx(\"div\",{class:\"d-flex justify-content-center\",children:/*#__PURE__*/_jsx(\"div\",{class:\"spinner-border\",role:\"status\",children:/*#__PURE__*/_jsx(\"span\",{class:\"sr-only\"})})}),storeSnapshot===null||storeSnapshot===void 0?void 0:(_storeSnapshot$docs=storeSnapshot.docs)===null||_storeSnapshot$docs===void 0?void 0:_storeSnapshot$docs.map(function(store){var _store$data,_store$data2,_store$data3,_store$data4;return/*#__PURE__*/_jsx(\"div\",{className:\"col-md-3\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card  text-center mb-5 \",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"img\",{className:\"card-img-top p-5\",src:store===null||store===void 0?void 0:(_store$data=store.data())===null||_store$data===void 0?void 0:_store$data.image_url})}),/*#__PURE__*/_jsx(\"h4\",{className:\"card-title\",style:{fontWeight:\"600\"},children:store===null||store===void 0?void 0:(_store$data2=store.data())===null||_store$data2===void 0?void 0:_store$data2.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-text\",children:store===null||store===void 0?void 0:(_store$data3=store.data())===null||_store$data3===void 0?void 0:_store$data3.timing}),/*#__PURE__*/_jsx(\"span\",{style:{color:\"rgba(0,0,0,0.5)\"},children:store===null||store===void 0?void 0:(_store$data4=store.data())===null||_store$data4===void 0?void 0:_store$data4.contact_detail})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-footer text-muted d-flex justify-content-between\",children:[/*#__PURE__*/_jsx(Button,{variant:\"success\",onClick:function onClick(){setupdateStore(_objectSpread(_objectSpread({},store===null||store===void 0?void 0:store.data()),{},{id:store===null||store===void 0?void 0:store.id}));setShow(true);},children:\"EDIT\"}),/*#__PURE__*/_jsx(Button,{variant:\"danger\",onClick:function onClick(e){var _store$data5;return window.confirm(\"Are you sure you wish to delete this item?\")&&deleteItem(store===null||store===void 0?void 0:store.id,store===null||store===void 0?void 0:(_store$data5=store.data())===null||_store$data5===void 0?void 0:_store$data5.image_url);},children:\"DELETE\"})]})]})});})]})]})}),/*#__PURE__*/_jsx(Suspense,{fallback:/*#__PURE__*/_jsx(\"div\",{children:\"Loading.... \"}),children:/*#__PURE__*/_jsx(StoreUpdate,{sdata:updateStore,openHandle:openHandle,closeHandle:closeHandle,show:show})})]});};export default StoreManage;","map":null,"metadata":{},"sourceType":"module"}